


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>搜索API &mdash; sf1-doc 0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="sf1-doc 0.1 documentation" href="../../index.html"/>
        <link rel="next" title="文档操作API" href="../document/API.html"/>
        <link rel="prev" title="商品排序" href="../../functions/sort/ProductSort.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../../index.html" class="fa fa-home"> sf1-doc</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="../../faq/Faq.html">常见问题</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../faq/Faq.html#sf1r">什么是SF1R</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/Faq.html#id2">SF1R的历史和特色</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/Faq.html#id3">为什么采用SF1R</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/Faq.html#zambezi">Zambezi索引</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/Faq.html#suffix">Suffix索引</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../basic-concepts/BasicConcepts.html">基本概念</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../basic-concepts/BasicConcepts.html#collection">collection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic-concepts/BasicConcepts.html#scd">什么是SCD，格式</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic-concepts/BasicConcepts.html#id4">数据文件目录</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../config/HowTo.html">配置说明</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../config/HowTo.html#sf1">SF1配置文件说明</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config/HowTo.html#system">System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config/HowTo.html#collection">Collection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config/HowTo.html#deployment">Deployment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../build/HowTo.html">如何编译安装</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../build/HowTo.html#id2">依赖包安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../build/HowTo.html#id4">第三方库安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../build/HowTo.html#sf1ruby-driver">安装SF1的Ruby Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../build/HowTo.html#sf1">如何下载SF1代码</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../build/HowTo.html#id5">如何编译SF1代码</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../build/HowTo.html#id6">如何打包</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../build/HowTo.html#id7">编辑打包脚本</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../build/HowTo.html#id8">如何运行二进制文件</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../functions/Functions.html">功能介绍</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../functions/search/Search.html">搜索</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../functions/index/Index.html">索引</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../functions/word_segment/word_segment.html">分词</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../functions/sort/sort.html">排序</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">搜索API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">参数</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">示例</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../document/API.html">文档操作API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../document/API.html#id1">创建文档</a></li>
<li class="toctree-l2"><a class="reference internal" href="../document/API.html#id2">删除文档</a></li>
<li class="toctree-l2"><a class="reference internal" href="../document/API.html#id3">更新文档</a></li>
<li class="toctree-l2"><a class="reference internal" href="../document/API.html#id4">原地更新文档</a></li>
<li class="toctree-l2"><a class="reference internal" href="../document/API.html#id5">获取文档</a></li>
<li class="toctree-l2"><a class="reference internal" href="../document/API.html#id6">获取文档数量</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../collection/API.html">collection日常维护与管理</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../collection/API.html#id1">检查</a></li>
<li class="toctree-l2"><a class="reference internal" href="../collection/API.html#id2">创建</a></li>
<li class="toctree-l2"><a class="reference internal" href="../collection/API.html#id3">删除</a></li>
<li class="toctree-l2"><a class="reference internal" href="../collection/API.html#id4">载入许可证</a></li>
<li class="toctree-l2"><a class="reference internal" href="../collection/API.html#id5">重新构建索引</a></li>
<li class="toctree-l2"><a class="reference internal" href="../collection/API.html#scdcollection">从SCD重建collection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../collection/API.html#id6">停止collection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../collection/API.html#id7">更新配置信息</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../commands/API.html">命令API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../commands/API.html#id1">建立索引</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands/API.html#id2">重新构建查询功能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands/API.html#id3">重新构建挖掘功能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands/API.html#id4">优化索引</a></li>
</ul>
</li>
</ul>
<ul class="simple">
</ul>
<ul class="simple">
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../operation/Schema.html">配置样例</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../operation/Schema.html#collection">collection集合</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">sf1-doc</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
    <li>搜索API</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../../_sources/API/search/API.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="api">
<h1>搜索API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h1>
<p>该API提供SF1的核心功能：全文检索，请求(Request)和响应(Response)都以JSON串的
格式包装。</p>
<p>URI: <a class="reference external" href="http://server/sf1r/documents/search">http://server/sf1r/documents/search</a></p>
<div class="section" id="id1">
<h2>参数<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>请求中各参数说明如下：</p>
<ul>
<li><p class="first">collection（字符串类型）：collection名称</p>
</li>
<li><p class="first">search（对象类型）：提供和搜索相关的参数</p>
<blockquote>
<div><ul>
<li><p class="first">keywords（字符串类型）：用户输入的搜索关键词</p>
</li>
<li><p class="first">in（数组类型）：设置搜索在哪儿字段上执行，默认为在所有字段上执行。</p>
</li>
<li><p class="first">ranking_model：文档相关度的计算模型。SF1内部有3种模型供用户选择：</p>
<blockquote>
<div><ul class="simple">
<li>plm模型</li>
<li>bm25模型</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">searching_mode：搜索模式。SF1提供了多种常用的搜索模式:</p>
<blockquote>
<div><ul class="simple">
<li>and（默认）</li>
<li>or</li>
<li>wand</li>
<li>suffix</li>
<li>knn</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">analyzer：关键字分析器的相关参数：</p>
<blockquote>
<div><ul class="simple">
<li>use_synonym_extension（布尔类型）：使用使用同义词扩展，默认false。</li>
<li>apply_la（布尔类型）：是否对关键字分词，默认true。</li>
<li>use_original_keyword（布尔类型）：默认false。</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">query_abbreviation（整数类型）: 指定原始query搜索结果为空时，返回经过查询缩写处理过的搜索结果的个数</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">select（数组类型）：设置搜索结果包含哪些字段。</p>
</li>
<li><p class="first">conditions（数组类型）：搜索结果的过滤条件，需要指定在哪儿属性设置过滤条件。</p>
<blockquote>
<div><ul>
<li><p class="first">property（字符串类型）：属性名称</p>
</li>
<li><p class="first">operator（字符串类型）：条件操作符。包含如下：</p>
<blockquote>
<div><ul class="simple">
<li>=  ：等于操作符</li>
<li>&lt;&gt; ：不等于操作符</li>
<li>&lt;  ：小于操作符</li>
<li>&lt;= : 小于等于操作符</li>
<li>&gt;  : 大于操作符</li>
<li>&gt;= : 大于等于操作符</li>
<li>between ：区间操作符</li>
<li>in : 属于操作符</li>
<li>not_in : 不属于操作符</li>
<li>starts_with : 前缀操作符，仅适用于字符串属性</li>
<li>ends_with : 后缀操作符，仅适用于字符串属性</li>
<li>contains : 包含操作符，仅适用于字符串属性</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">value：属性值</p>
</li>
</ul>
</div></blockquote>
</li>
<li><dl class="first docutils">
<dt>sort（数组类型）：对搜索结果排序</dt>
<dd><ul class="first last">
<li><p class="first">property（字符串)：属性名称（按该属性排序）</p>
</li>
<li><p class="first">order（字符串）：升序或降序</p>
<blockquote>
<div><ul class="simple">
<li>ASC：升序</li>
<li>DESC：降序</li>
</ul>
</div></blockquote>
</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">limit（整数类型）：限制返回文档的个数，默认20。</p>
</li>
<li><dl class="first docutils">
<dt>offset（整数类型）：该参数一般和limit一起使用，默认0。如果每页返回10个文档，则第一页</dt>
<dd><p class="first last">的参数应该是“limit=10，offset=0”，第二页的参数设置“limit=10，offset=10“</p>
</dd>
</dl>
</li>
<li><p class="first">remove_duplicated_result（布尔类型）：设置搜索结果中是否去除重复文档，默认true，该参数只有当去重服务在&lt;MiningBundle&gt;里配置方才有效。</p>
</li>
</ul>
<p>响应中各参数说明如下：</p>
<ul>
<li><p class="first">total_count（整数类型）：匹配文档总数，如果查询为Suffix模式，则该数值为估计值。</p>
</li>
<li><p class="first">top_k_count（整数类型）：返回实际的top k结果数目。</p>
</li>
<li><p class="first">resources（数组类型）：该参数中的每一个对象都是一个文档。每个文档由一系列的K-V对组成，key即为属性名称，而v  alue即为属性值。下面给出可能出现的特殊的属性：</p>
<blockquote>
<div><ul class="simple">
<li>DOCID（字符串类型）：</li>
<li>_id（整数类型）：SF1内部用来标示文档的ID</li>
<li>_duplicate_document_count（整数类型）：和该文档重复的文档数目，该参数仅当去重计算模块配置时方才有效</li>
<li>_similar_document_count（整数类型）：和该文档相似的文档数目，该参数仅当语义相似度计算模块配置时方才有效</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">related_queries（数组类型）：字符串类型的数组，标识相关联的查询请求。</p>
</li>
<li><p class="first">taxonomy（对象类型）：分类结果：</p>
<blockquote>
<div><ul>
<li><p class="first">labels（数组类型）：分类标签</p>
<blockquote>
<div><ul class="simple">
<li>label（字符串类型）：标签名称</li>
<li>document_count（整数类型）：属于该标签的文档数</li>
<li>sub_labels（数组类型）：子标签数组，结构与本标签一致。</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">range（对象类型）：属性值的范围</p>
<blockquote>
<div><ul class="simple">
<li>max（浮点数类型）：最大属性值</li>
<li>min（浮点数类型）：最小属性值</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">count（Map类型）： 返回查询对应某属性的个数，类似Select Count(*) 语义</p>
</li>
<li><p class="first">refined_query（字符串类型）：在查询结果数目小于设定的阈值时，重新定义的查询请求。</p>
</li>
<li><p class="first">group（数组类型）：每个对象标识每个属性的分组结果</p>
<blockquote>
<div><ul>
<li><p class="first">property（字符串类型）：属性名</p>
</li>
<li><p class="first">document_count（整数类型）：搜索结果中包含该属性的文档数目</p>
</li>
<li><p class="first">labels（数组类型）：分组标签。每个标签表示一个属性值，有如下域：</p>
<blockquote>
<div><ul class="simple">
<li>label（字符串类型）：标签名称，标识属性值</li>
<li>document_count（整数类型）：该标签下的文档数目</li>
<li>sub_labels（数组类型）：子标签数组，与本标签有相同的结构。</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">attr（数组类型）：属性数组，每个对象标识一个属性。该数组按照document_count降序排列。</p>
<blockquote>
<div><ul>
<li><p class="first">attr_name（字符串类型）：属性名称</p>
</li>
<li><p class="first">document_count（整数类型）：搜索结果中包含该属性的文档的数目。</p>
</li>
<li><p class="first">labels（数组类型）：组标签。每个对象标识一个属性标签，具有如下结构：</p>
<blockquote>
<div><ul class="simple">
<li>label（字符串类型）：标签名，标识属性值</li>
<li>document_count（整数类型）：搜索结果中包含该标签的文档数目</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">top_group_label（数组类型）：每个对象代表一个为属性自动选择的组标签。</p>
<blockquote>
<div><ul class="simple">
<li>group_property（字符串类型）：属性名</li>
<li>group_label（数组类型）：组标签数组，每个对象代表从root节点到leaf节点的路径。</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="id2">
<h2>示例<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>下面给出search的请求与响应示例：</p>
<p>请求：</p>
<div class="highlight-python"><pre>{
    "collection": "ChnWiki",

    "search": {
        "keywords": "test",
        "log_keywords": true,
        "ranking_model": "plm",
        "analyzer": {
            "use_synonym_extension": true,
            "apply_la": true,
            "use_original_keyword": true
         },
        "in": [
            {"property": "title"},
            {"property": "content"}
        ]
    },

    "group": [
        {"property": "area"},
        {"property": "price"}
    ],

    "attr": {
        "attr_result": true
    }

    // operator list
    // - equal, =
    // - not_equal, &lt;&gt;
    // - greater_than, &gt;
    // - greater_than_or_equal, &gt;=
    // - less_than, &lt;
    // - less_than_or_equal, &lt;=
    // - in
    // - between
    // - starts_with
    // - ends_with
    // - contains
    "conditions": [
        {"property": "id", "operator": "equal", "value": 10},
        {"property": "id", "operator": "in", "value": [10, 20, 30]}
        {"property": "price", "operator": "between", "value": [10.0, 20.0]}
    ],

    "select": [
        { "property": "title" }
        { "property": "content",
        "highlight": false,
        "snippet": true,
        "summary": false,
        "summary_sentence_count": 3,
        "summary_property_alias": "content.summary" }
    ],

    "sort": [
        { "property": "title" },
        { "property": "content", "order": "ASC"},
        { "property": "_rank", "order": "DESC"}
    ],

    "limit": "20",
    "offset": "0",
    "remove_duplicated_result": true,
}</pre>
</div>
<p>响应：</p>
<div class="highlight-python"><pre>{
    "header": { "success": true },
    "errors": [
        "Error message 1",
        "Error message 2"
    ],

    "resources": [
        { "title": "xxx",
        "content": "xxx"},
        { "title": "yyy",
        "content": "yyy"}
    ],

    "related_queries": ["a", "b"],

    "taxonomy": {
        "labels": [
        { "label": "animal",
            "document_count": 10,
            "sub_labels": [
            { "label": "dog",
                "document_count": 6 },
            { "label": "cat",
                "document_count": 4 }
            ]
        },
        { "label": "music",
            "document_count": 5 }
        ]
    },

    "group": [
        { "document_count": 10,
        "property": "area",
        "labels": [
            { "label": "China",
            "document_count": 7,
            "sub_labels": [
                { "label": "Shanghai",
                "document_count": 5 },
                { "label": "Beijing",
                "document_count": 2 }
            ]
            },
            { "label": "America",
            "document_count": 3 }
        ]
        },
        { "document_count": 10,
        "property": "price",
        "labels": [
            { "label": "100",
            "document_count": 4 },
            {"label": "200",
            "document_count": 6 }
        ]
        }
    ]

    "attr": [
        { "document_count": 10,
        "attr_name": "品牌",
        "labels": [
            { "label": "阿依莲",
            "document_count": 7},
            { "label": "淑女屋",
            "document_count": 3}
        ]
        },
        { "document_count": 8,
        "attr_name": "尺码",
        "labels": [
            { "label": "L",
            "document_count": 5},
            { "label": "M",
            "document_count": 4},
            { "label": "XL",
            "document_count": 3}
        ]
        }
    ]
}</pre>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../document/API.html" class="btn btn-neutral float-right" title="文档操作API"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../../functions/sort/ProductSort.html" class="btn btn-neutral" title="商品排序"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013, Kevin Lin.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>